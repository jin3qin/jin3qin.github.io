---
title: pve ubuntu 安装RTX5060显卡驱动
description: 
author: jin3qin
date: 2026-01-29 11:47:00 +0800
categories: [Blogging, pve]
tags: [pve, Ubuntu]
pin: true
math: true
mermaid: true
image:
  path: /assets/img/pic/nvidia-smi.png
  alt: nvidia-smi console
---

## PVE配置

启动系统之前的配置类似如下

|配置项|内容|
|--|--|
|BIOS|OVMF（UEFI）|
|显示|默认|
|机型|q35|
|SCSI控制器|默认|
|PCI设备|主GPU:☑ 所有功能:☑ `ROM-Bar`:☐ PCI-Express:☑|


## 安装驱动

### 预处理

+ 提前先安装依赖，由于nvidia安装驱动编译可能需要gcc12的版本，所以一起安装

``` bash
sudo apt install -y make gcc g++ gcc-12 build-essential curl vim
```

+ 禁止系统自带的nvidia开源驱动，并且重启

``` bash
sudo su
echo "blacklist nouveau" >> /etc/modprobe.d/blacklist.conf
echo "options nouveau modeset=0" >> /etc/modprobe.d/blacklist.conf
update-initramfs -u
reboot
```

### 安装nvidia驱动

#### 官方版本安装

+ 在 [NVIDIA-GeForce® 驱动程序](https://www.nvidia.cn/geforce/drivers/) 下载自己机器的显卡驱动，版本选择随意，我这里保守选择`570.xxx.xx`的版本。给下载好的驱动文件上执行权限，并运行

``` bash
chmod +x NVIDIA-Linux-x86_64-570.xxx.xx.run
sudo ./NVIDIA-Linux-x86_64-570.xxx.xx.run
```

|提示语|安装过程选项|
|--|--|
|Multiple kernel module types are available for this system|`NVIDIA Proprietary` MIT/GPL|
|You appear to be running an X server|`Continue installation` Abort installation|
|Install NVIDIA's 32-bit compatibility libraries|Yes `No`|
|Would you like to run the nvidia-xconfig utility to<br> automatically update your X configuration file|Yes `No`|

安装完成重启
``` bash
sudo reboot
```

#### 社区版本安装

官方版本安装过程如果提示不支持，就需要安装社区版本

- 卸载官方版本驱动

``` bash
sudo nvidia-uninstall
sudo apt autoremove
sudo reboot
```

- 安装社区版本

``` bash
sudo apt install nvidia-driver-570-open
```

### 验证

+ 查看nvidia监视器

``` bash
nvidia-smi
```

``` console
jin3qin@pve:~$ nvidia-smi
Fri Jan 30 10:02:28 2026
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 570.211.01             Driver Version: 570.211.01     CUDA Version: 12.8     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce RTX 5060        Off |   00000000:01:00.0  On |                  N/A |
|  0%   28C    P8              7W /  155W |     307MiB /   8151MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|    0   N/A  N/A            1026      G   /usr/lib/xorg/Xorg                       67MiB |
|    0   N/A  N/A            1216    C+G   ...c/gnome-remote-desktop-daemon        112MiB |
|    0   N/A  N/A            1270      G   /usr/bin/gnome-shell                     82MiB |
+-----------------------------------------------------------------------------------------+
```

+ 查看内核模块

``` bash
lsmod | grep -i nvidia
```

``` console
jin3qin@pve:~$ lsmod | grep -i nvidia
nvidia_uvm           2121728  4
nvidia_drm            131072  10
nvidia_modeset       1728512  10 nvidia_drm
nvidia              11657216  172 nvidia_uvm,nvidia_modeset
video                  77824  1 nvidia_modeset
ecc                    45056  1 nvidia
```

### 完善

+ 安装动态内核模块管理、内核头文件，方便升级内核自己打驱动

``` bash
sudo apt install dkms linux-headers-$(uname -r)
```

添加对nvidia驱动的管理，重新添加会报错，说明已经加上

``` bash
sudo dkms add -m nvidia -v 570.xxx.xx
```

``` console
jin3qin@pve:~$ sudo dkms add -m nvidia -v 570.211.01
[sudo] password for jin3qin:
Error! DKMS tree already contains: nvidia-570.211.01
You cannot add the same module/version combo more than once.
```

## 点亮屏幕

先关闭虚拟机，然后将之前`硬件-PCI设备-ROM-Bar`未勾选的勾选上，显示依旧是默认或者标准VGA

|配置项|内容|
|--|--|
|PCI设备|主GPU:☑ 所有功能:☑ `ROM-Bar`:☑ PCI-Express:☑|
|显示|默认 / 标准VGA|

## 远程桌面

ubuntu作为服务端，需要手动开启服务。

+ 打开`设置`，选择`Sharing-Remote Desktop-Enable Legacy VNC Protocol`，Password设置一个密码。打开`Passwords and Keys`，右键`Login-Change Password`，设置密码为`空`。

> 如果`Passwords and Keys`中不删除登录密码，会导致VNC的登录密码在每次重启后更新

+ VNC客户端下载`RealVNC`，这个是免费客户端

|配置项|内容|说明|
|--|--|--|
|General|Address|ubuntu的ip地址|
||Name|随便|
|Options|Picture quality|除了Auto任意一个,High画质最高|
||Scaling|100%|